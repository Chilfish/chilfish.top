---
import Image from '@cp/common/Image.astro'
import BackToTop from '@cp/common/BackToTop.astro'
import TableOfContent from '@cp/post/TableOfContent.vue'
import PostMeta from '@cp/post/PostMeta.astro'
import AdjacentPosts from '@cp/post/AdjacentPosts.astro'
import Layout from './Layout.astro'
import '@assets/post-details.scss'
import type { Post } from '~/types'

type Props = {
  post: Post
}
const { post } = Astro.props

const { title, author, description, date, maxDepthTOC, tags, keywords, cover } = post.data

const { Content, headings } = await post.render()
---

<Layout
  title={title}
  description={description}
  keywords={keywords}
  author={author}
  date={date}
  aclass="mx-auto relative"
>
  <section
    id="page-top"
    class="flex px-4 sm:px-12"
  >
    <AdjacentPosts
      type={post.collection}
      slug={post.slug}
    />

    <main
      class="w-full"
      uno-md="mx-10 w-19/30"
    >
      <article>
        <PostMeta
          title={title}
          author={author!}
          pubDate={date!}
          tags={tags}
        />

        { cover && (
          <Image
            src={cover}
            alt={title}
            width={1200}
            height={630}
            class="h-64 w-full rounded-lg object-cover object-top-center transition-height sm:h-96"
          />
        )}
        <Content />
      </article>
    </main>

    <TableOfContent
      headers={headings}
      maxDeep={maxDepthTOC || 4}
      client:idle
    />
  </section>

  <BackToTop />
</Layout>
