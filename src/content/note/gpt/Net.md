---
title: Network
date: 2023-03-01
tags: [GPT]
---

### 讲解链路层

当两个设备在计算机网络上进行通信时，它们之间需要一个物理连接。链路层是计算机网络中的第二层协议，主要负责在这种物理连接上传输数据。链路层协议通常被实现在网络适配器（Network Interface Card，NIC）上，它是计算机用于将数字数据转换为模拟信号并传输到物理网络上的硬件设备

链路层协议的主要功能包括：

1.  数据帧封装：将来自网络层的数据包封装成一个数据帧，以便在物理链路上进行传输
2.  媒体访问控制：当多个设备共享同一个物理链路时，链路层协议负责确定哪个设备可以访问该链路并传输数据。常用的媒体访问控制技术包括 CSMA/CD 和令牌环
3.  错误检测和纠正：链路层协议负责检测并纠正在物理传输过程中产生的传输错误，以保证数据传输的可靠性
4.  流量控制：链路层协议可以使用一些技术，如滑动窗口协议，来控制数据传输的速率，以避免网络拥塞或资源浪费

在计算机网络中，链路层协议有很多种类型，如以太网、无线局域网（Wi-Fi）、蓝牙等。它们各自具有不同的特点和适用范围，但都扮演着将数据从一个设备传输到另一个设备的重要角色

### 网桥与中继器的区别

网桥（Bridge）和中继器（Repeater）是用于计算机网络中连接不同网络设备的网络设备，它们的主要区别如下：

1.  工作层次不同：网桥工作在 OSI 模型的第二层（数据链路层），而中继器工作在第一层（物理层）
2.  处理方式不同：中继器只是简单地将数据从一个端口传输到另一个端口，而网桥则能够检查数据包的目的 MAC 地址，以决定是否将数据包转发到另一个网络
3.  处理数据的范围不同：中继器只能放大信号，扩大信号传输的范围，但是无法处理数据包，而网桥可以处理数据包并根据 MAC 地址选择将其转发到哪个端口
4.  连接设备的数量不同：中继器只能连接两个设备，而网桥可以连接多个设备
5.  网络效率不同：由于中继器只是简单地重复信号，所以当网络中有多个中继器连接时，可能会出现信号冲突和数据包丢失等问题。而网桥可以根据 MAC 地址选择最佳转发路径，从而提高网络的效率

总的来说，网桥比中继器更智能、更高效，但成本也更高。在现代网络中，网桥的功能已经被交换机所取代，交换机可以实现网桥的所有功能，并且在性能和扩展性方面更优秀

### 概述一下《计算机网络：自顶向下方法（第七版）》中，第六章 链路层 的内容

第六章《链路层》是《计算机网络：自顶向下方法（第七版）》中的一个重要章节，主要介绍了链路层协议的概念、功能和实现，以及一些常见的链路层技术和协议

具体来说，该章节包含以下内容：

1.  链路层介绍：首先对链路层进行了简要介绍，包括链路层协议的主要功能、数据帧的结构和链路层的地址类型
2.  差错检测和纠正：介绍了循环冗余检验（CRC）技术，该技术可以检测链路层传输过程中可能出现的差错，并纠正一部分差错
3.  多路访问协议：介绍了多路访问协议，包括随机接入多路访问协议（ALOHA 和 CSMA/CD）和令牌传递多路访问协议（令牌环和令牌总线）
4.  局域网（LAN）：介绍了局域网的概念、分类和拓扑结构，以及以太网、Wi-Fi 和蓝牙等常见的 LAN 技术和协议
5.  数据中继：介绍了中继器和网桥这两种常见的数据中继设备，并比较了它们的区别和优缺点
6.  路由器和链路层交换机：介绍了路由器和链路层交换机这两种重要的网络设备，以及它们的主要功能和实现
7.  无线局域网（WLAN）：介绍了 WLAN 的概念、技术和协议，包括无线传输介质、WLAN 的拓扑结构和通信方式、802.11 协议等

总体来说，该章节内容较为丰富，既包括链路层的基本知识，又涉及了很多实际应用和具体的技术协议，对于理解计算机网络的运作机制和实际应用具有很大的帮助

### 冲突域和广播域

在计算机网络中，冲突域（Collision Domain）和广播域（Broadcast Domain）是两个重要的概念

冲突域是指当两个或多个设备同时发送数据时可能会发生冲突的范围。在以太网中，如果两个设备同时发送数据，数据会发生碰撞（Collision），导致数据包损坏。因此，为了避免冲突，以太网采用了 CSMA/CD 协议，即带有冲突检测的载波监听多路访问协议，它可以检测到冲突并进行相应的处理。冲突域的大小取决于网络的拓扑结构和中继设备的数量，每个中继器的端口都在同一个冲突域中

广播域是指当一个设备发送广播消息时，该消息会被发送到的所有设备所组成的范围。在以太网中，广播消息的目的地址为全 1，因此广播消息会被发送到所有设备。广播域的大小取决于网络的拓扑结构和路由器的数量，每个路由器的端口都在不同的广播域中

在现代网络中，随着网络规模的扩大和技术的发展，为了提高网络的性能和可靠性，常常采用一些技术手段来控制冲突域和广播域的大小。例如，可以采用交换机来代替集线器（hub），从而将每个端口分成独立的冲突域；可以采用虚拟局域网（VLAN）技术来划分不同的广播域，从而降低广播消息的传输量，提高网络的效率

### 简述局域网中两台主机发送数据时 ARP 协议的工作过程

在局域网中，当一台主机需要向另一台主机发送数据时，需要先知道目标主机的 MAC 地址，而 IP 地址则不能直接用于在局域网中传输数据。这时就需要使用 ARP 协议（地址解析协议）来获取目标主机的 MAC 地址

ARP 协议的工作过程如下：

1.  发送 ARP 请求：发送方主机（源主机）在向目标主机发送数据时，会先向局域网中的所有主机发送一个 ARP 请求，请求中包含发送方主机的 IP 地址和 MAC 地址以及目标主机的 IP 地址。ARP 请求是以广播方式发送的，因此所有主机都会接收到这个请求
2.  接收 ARP 请求：目标主机收到 ARP 请求后，会检查请求中的目标 IP 地址是否与自己的 IP 地址匹配。如果匹配，则向发送方主机发送一个 ARP 响应，响应中包含目标主机的 MAC 地址
3.  发送 ARP 响应：发送 ARP 响应的过程与发送 ARP 请求的过程类似，不同的是 ARP 响应是单播方式发送的，只有发送方主机能够接收到这个响应。发送方主机将目标主机的 MAC 地址与要发送的数据一起发送出去，这样数据就能够被目标主机接收和处理了
4.  缓存 ARP 表项：在主机发送或接收 ARP 请求和 ARP 响应时，会将目标主机的 IP 地址和 MAC 地址存储在本地的 ARP 缓存表中。这样，在下一次需要向该主机发送数据时，就不需要再发送 ARP 请求，而是直接从缓存表中获取目标主机的 MAC 地址

总之，ARP 协议的作用是将 IP 地址映射到 MAC 地址，以便主机能够在局域网中发送数据。通过发送 ARP 请求和接收 ARP 响应，主机可以获取目标主机的 MAC 地址，并将数据发送到目标主机。在此过程中，ARP 表项的缓存可以提高网络的性能和可靠性

### 数据段、数据报、数据包、帧的区别与联系

在计算机网络中，数据段、数据报、数据包和帧是数据在不同层次进行封装的不同术语。它们之间的区别和联系如下：

1.  数据段：在传输层中，数据段是指 TCP 或 UDP 协议传输的数据单位。在发送端，传输层将应用层传来的数据分成若干个数据段，每个数据段包含一个首部和一个负载部分，然后将这些数据段分别交给网络层进行传输。在接收端，网络层收到数据段后，将其重新组合成完整的数据
2.  数据报/数据包：在网络层中，数据报或数据包是指 IP 协议传输的数据单位。数据报由 IP 首部和 IP 数据组成，其中 IP 首部包含源 IP 地址和目的 IP 地址等信息，而 IP 数据则是传输层分段后的数据段的负载部分。在发送端，网络层将应用层的数据加上 IP 首部后封装成数据报，然后交给数据链路层进行传输。在接收端，数据链路层收到数据报后，将其解封并交给网络层进行处理
3.  帧：在数据链路层中，帧是指以太网协议传输的数据单位。帧由帧首部、数据部分和帧尾部组成。帧首部包含源 MAC 地址和目的 MAC 地址等信息，数据部分则是网络层传来的数据报的负载部分，而帧尾部包含帧校验码等信息。在发送端，数据链路层将网络层传来的数据报加上帧首部和帧尾部后封装成帧，然后交给物理层进行传输。在接收端，物理层收到帧后，将其解封并交给数据链路层进行处理

综上所述，数据段、数据报、数据包和帧是网络协议在不同层次进行封装的不同术语。数据段是传输层的数据单位，数据报或数据包是网络层的数据单位，而帧则是数据链路层的数据单位。这些单位之间的联系在于它们都是用来传输数据的，而不同层次之间的封装和解封装则使得数据能够在不同层次之间进行传输和处理

### 交换机地址表自学习和转发算法

交换机是计算机网络中常用的设备之一，主要用于在局域网内进行数据包转发。交换机通过学习源 MAC 地址和端口号的映射关系，建立地址表，实现对数据包的快速转发。其中，交换机地址表自学习和转发算法是实现交换机数据包转发的关键技术

1. 地址表自学习：

交换机通过学习源 MAC 地址和端口号的映射关系，建立地址表，实现对数据包的快速转发。具体而言，当交换机收到一个数据包时，它会查看数据包中的源 MAC 地址，并将这个地址和数据包的输入端口记录在地址表中。然后，当交换机接收到另一个数据包时，它会再次查看数据包中的源 MAC 地址，并在地址表中查找该地址对应的端口。如果找到了该端口，则交换机将数据包直接发送到该端口。如果找不到该端口，则交换机将广播数据包到所有端口，以便寻找目标设备并更新地址表

2. 转发算法：

交换机的转发算法是指它在接收到一个数据包后如何决定将数据包转发到哪个端口。交换机转发数据包的过程分为两个步骤：首先，交换机会查看数据包中的目的 MAC 地址，并在地址表中查找该地址对应的端口。如果找到了该端口，则交换机将数据包直接发送到该端口。如果找不到该端口，则交换机将广播数据包到所有端口，以便寻找目标设备并更新地址表。其次，交换机会更新地址表，将源 MAC 地址和端口号的映射关系记录在地址表中，以便下次快速转发数据包

总之，交换机地址表自学习和转发算法是交换机实现局域网内数据包快速转发的关键技术。通过自学习建立地址表，交换机可以快速找到数据包对应的端口并进行转发；而通过转发算法的优化，交换机可以避免广播风暴和提高数据包转发的效率

#### 举些例子

当交换机收到一个数据包时，它会检查该数据包中的源 MAC 地址，并将该地址与数据包输入端口之间的映射关系存储到交换机的地址表中。下表是一个简单的地址表示例：

```txt
| MAC地址 | 端口号 |
| --- | --- |
| 00-11-22-33-44-55 | 1 |
| 66-77-88-99-AA-BB | 2 |
| CC-DD-EE-FF-00-11 | 3 |
```

假设交换机当前连接了 3 台设备，分别是：

1.  设备 A，MAC 地址为 00-11-22-33-44-55，连接到端口 1
2.  设备 B，MAC 地址为 66-77-88-99-AA-BB，连接到端口 2
3.  设备 C，MAC 地址为 CC-DD-EE-FF-00-11，连接到端口 3

当设备 A 向设备 B 发送一个数据包时，交换机将检查数据包中的目标 MAC 地址并查找它在地址表中的对应端口。在这个例子中，数据包的目标 MAC 地址是 66-77-88-99-AA-BB，交换机可以直接从地址表中找到该地址与端口 2 之间的映射关系，因此它将数据包转发到端口 2，而不是广播到所有端口

当设备 D 向设备 E 发送一个数据包时，交换机将检查数据包中的目标 MAC 地址并查找它在地址表中的对应端口。在这个例子中，数据包的目标 MAC 地址是 11-22-33-44-55-66，地址表中没有该地址的记录，因此交换机将广播该数据包到所有端口，以便寻找目标设备并更新地址表。如果设备 E 此时响应了该数据包，交换机将学习到 E 的 MAC 地址和它所连接的端口号，并在地址表中创建相应的记录，以便下次快速转发数据包

### 交换机会在什么时候选择丢弃而不是转发

交换机可能会在以下情况下选择丢弃数据包而不是转发：

1.  端口发生拥塞：当一个交换机端口接收到的数据包数量超过了它所支持的最大带宽，交换机就会发生拥塞。为了防止拥塞蔓延到整个网络中，交换机可以选择丢弃一些数据包以减轻网络负载
2.  数据包长度超过 MTU：当交换机接收到的数据包长度超过了该网络所支持的最大传输单元 (MTU) 时，交换机可能会选择丢弃该数据包，因为它不能分割该数据包并转发到其他网络
3.  目标设备无法到达：如果交换机无法将数据包转发到目标设备，例如该设备已断开连接或故障，交换机可能会选择丢弃该数据包，以避免浪费网络资源

在这些情况下，交换机通常会向发送端发送一个丢包通知，告诉发送端数据包已经被丢弃，以便发送端可以重新发送该数据包或执行其他纠错操作

### ip 分组转发算法

IP 分组转发算法是一种在网络层执行的算法，用于将收到的 IP 分组转发到正确的目标设备或下一个网络。该算法通常用于路由器等网络设备中

IP 分组转发算法的基本思想是：根据每个接口的 IP 地址和子网掩码，将接收到的 IP 分组与目的 IP 地址进行比较，以确定下一跳的接口。该算法使用路由表来存储每个目的 IP 地址的下一跳信息，并使用路由协议（如 RIP、OSPF 等）来动态维护路由表。当一个 IP 分组到达路由器时，路由器会查找路由表以确定下一跳接口，并将该分组转发到该接口。如果路由器无法找到适当的路由，则丢弃该分组并向发送方发送 ICMP 错误消息

IP 分组转发算法是将网络层分组从源节点路由到目标节点的基本机制。它可以使网络设备在不同的物理连接和逻辑子网之间转发 IP 分组，从而实现不同子网之间的通信

### TCP 的拥塞控制算法

TCP 的拥塞控制算法是 TCP 协议中用于控制网络拥塞的一组算法，主要用于确保 TCP 协议能够在网络中高效、可靠地传输数据。拥塞控制算法的主要目标是避免网络拥塞，即在网络中传输过多的数据而导致网络性能下降或崩溃

TCP 的拥塞控制算法主要有四个部分：

1.  慢启动：在 TCP 连接刚开始时，拥塞控制算法将发送方的拥塞窗口大小初始化为一个较小的值，然后随着时间的推移，逐步增加拥塞窗口大小，直到达到网络的容量上限或出现拥塞为止
2.  拥塞避免：当网络开始出现拥塞时，TCP 拥塞控制算法将减小拥塞窗口大小，以避免进一步加重网络拥塞。在拥塞避免阶段，TCP 将根据网络状况和拥塞窗口大小等因素动态调整发送速率
3.  快速重传：当 TCP 发送方检测到丢失的数据包时，它将立即发送一个重复确认来请求该数据包的重新发送，而不是等待超时重传。这种快速重传机制可以大大提高网络吞吐量和响应速度
4.  快速恢复：当 TCP 发送方接收到三个重复确认时，它将进入快速恢复状态，并将拥塞窗口大小设置为先前窗口大小的一半，以避免进一步加重网络拥塞

TCP 的拥塞控制算法可以确保在网络中传输的数据量不超过网络的容量，从而避免网络拥塞和性能下降。同时，拥塞控制算法也能够适应不同的网络状况和数据传输需求，从而提高 TCP 协议的可靠性和效率

### TCP 拥塞

TCP 拥塞是指当网络中的传输数据量超过网络容量时，网络出现阻塞或性能下降的现象。TCP 拥塞通常是由以下几个原因引起的：

1.  网络带宽不足：当网络带宽无法满足所有数据传输需求时，就会出现网络拥塞。这种情况通常出现在高峰时段或网络负载过重时
2.  路由器缓存不足：当网络中的路由器缓存空间不足时，路由器就无法及时处理和转发数据包，导致网络拥塞
3.  数据包丢失和重传：当 TCP 发送方无法收到确认信息时，它会重新发送数据包，从而增加网络负载和拥塞风险
4.  网络故障和故障恢复：当网络中出现故障时，如链路中断或路由器故障等，网络性能就会受到影响，导致拥塞

在实际应用中，TCP 拥塞通常是由多个因素共同作用而导致的。为了避免 TCP 拥塞，需要采用一系列拥塞控制算法，如 TCP 的慢启动、拥塞避免、快速重传和快速恢复等，来动态调整发送速率和拥塞窗口大小，确保网络传输高效、可靠和稳定

### 进行 IP 分片

当 IP 数据包的长度超过链路层的 MTU 时，IP 分片就会被使用。MTU 是指链路层数据传输的最大传输单元，它是硬件和网络协议的共同限制，通常为 1500 字节

IP 分片过程如下：

1.  发送方的 IP 层将原始数据包分成一些小片，每个小片的大小不超过 MTU
2.  IP 层在每个小片的头部中添加一个 IP 分片首部，其中包含片偏移、标识符和其他控制信息。其中，片偏移指定小片在原始数据包中的位置，标识符用于标识原始数据包
3.  将 IP 分片发送到网络中
4.  接收方的 IP 层接收所有分片，并将它们按顺序组装成原始数据包。组装过程使用分片首部中的片偏移和标识符信息来确定分片的顺序和关系
5.  如果一个分片在传输过程中丢失或无法组装，接收方的 IP 层会请求发送方重新发送数据

需要注意的是，IP 分片会增加网络负载和带宽占用，同时会降低网络性能和可靠性。因此，当可能出现 IP 分片时，建议尽量避免使用大的 IP 数据包，或者使用更高效的数据传输协议，如 UDP
