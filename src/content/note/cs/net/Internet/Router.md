---
title: 路由器及其转发算法
date: 2023-02-28
---

### ip 分组转发算法

IP 分组转发算法是将网络层分组从源节点路由到目标节点的基本机制。它可以使网络设备在不同的物理连接和逻辑子网之间转发 IP 分组，从而实现不同子网之间的通信

IP 分组转发算法的基本思想是：根据每个接口的 IP 地址和子网掩码，将接收到的 IP 分组与目的 IP 地址进行比较，以确定下一跳的接口

- 该算法使用路由表来存储每个目的 IP 地址的下一跳信息，并使用路由协议（如 RIP、OSPF 等）来动态维护路由表
- 当一个 IP 分组到达路由器时，路由器会查找路由表以确定下一跳接口，并将该分组转发到该接口
- 如果路由器无法找到适当的路由，则丢弃该分组并向发送方发送 ICMP 错误消息

可以通过目的地址 IP 和源地址的子网掩码进行逻辑与运算得到目的网络地址

- 如果目的网络地址和源网络地址 相同，就是在同一个网络中，属于直接交付
- 如果目的网络地址和源网络地址 不相同，就不在同一个网络中，属于间接交付，传输给主机所在网络的默认网关（路由器），由默认网关帮忙转发

用户为了让本网络中的主机能和其他网络中的主机进行通信，就必须给其指定本网络的一个路由器的接口，由该路由器帮忙进行转发，所指定的路由器，也被称为**默认网关**

例如。路由器的接口 0 的 IP 地址 `192.168.0.128` 做为左边网络的默认网关

![以这个网络为例](/blog/cs/Router_sample.webp)

> 主机 A 会将该 IP 数据报传输给自己的默认网关，也就是图中所示的路由器接口 0

#### 路由器收到 IP 数据报后如何转发？

- 检查 IP 数据报首部是否出错：
  - 若出错，则直接丢弃该 IP 数据报并通告源主机
  - 若没有出错，则进行转发
- 根据 IP 数据报的目的地址在路由表中查找匹配的条目：
  - 若找到匹配的条目，则转发给条目中指示的吓一跳
  - 若找不到，则丢弃该数据报并通告源主机

假设 IP 数据报首部没有出错，路由器取出 IP 数据报首部各地址字段的值，然后对该 IP 进行查表转发

### 路由器的路由表更新算法
