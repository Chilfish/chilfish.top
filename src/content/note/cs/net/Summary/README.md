---
title: 第0章 概述-计算机网络和因特网
date: 2022-09-26
---

## 计算机网络的定义和分类

### 定义

计算机网络的最简单的定义是：**一些互相连接的、自治的计算机的集合**

- 互连：是指计算机之间可以通过有线或无线的方式进行数据通信
- 自治：是指独立的计算机，他有自己的硬件和软件，可以单独运行使用
- 集合：是指至少需要两台计算机

#### 计算机网络的较好的定义是

- 计算机网络主要是由一些通用的，可编程的硬件（一定包含有中央处理机 CPU）互连而成的，而这些硬件并非专门用来实现某一特定目的（例如，传送数据或视频信号）。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用
- 计算机网络所连接的硬件，并不限于一般的计算机，而是包括了智能手机等智能硬件
- 计算机网络并非专门用来传送数据，而是能够支持很多种的应用（包括今后可能出现的各种应用）

### 分类

**按交换技术分类：** 电路交换网络 | 报文交换网络 | 分组交换网络

**按使用者分类：** 公用网 | 专用网

**按传输介质分类：** 有线网络 | 无线网络

#### 按覆盖范围分类

- **广域网 WAN**（Wide Area Network） <br> &emsp;&emsp; 作用范围通常为几十到几千公里，因而有时也称为**远程网**（long haul network）。广域网是互联网的核心部分，其任务是通过长距离（例如，跨越不同的国家）运送主机所发送的数据
- **城域网 MAN：** 作用范围一般是一个城市，可跨越几个街区甚至整个城市
- **局域网 LAN：** 一般用微型计算机或工作站通过高速通信线路相连（速率通常在 $10 Mbit/s$ 以上），但地理上范围较小（$1 km$ 左右）
- **个域网 PAN：** 就是在个人工作的地方把个人使用的电子设备用无线技术连接起来的网络

## 因特网概述

多个 **主机** 或 **端系统** 通过 **链路系统** 和 **分组交换机** 连接到一起

- 链路系统主要是由不同类型的 **物理媒介** 组成，如网线、光纤、电缆等，链接的速度（**传输速率**）由 **bit/s** 或 **bps** 度量。它们将数据分组（packet）传输
- 交换机主要是 **路由器（router）** 和 **链路层交换机**。前者位于网络的核心中，后者常用于接入网中。交换机类似于是网络的分叉口，决定着数据要去的 **路径（path 或 route）**
- 端系统通过 **因特网服务提供商（ISP）** 接入到因特网
- 这些端系统、交换机和其他的因特网部件都要遵循一系列的 **协议**，这些协议控制着因特网中信息的接受和发送。其中以 **TCP（传输控制协议）** 和 **IP（网际协议）** 为重要

### 网络 互联网和因特网

**网络：** 网络（Network）由若干 **结点（Node）** 和连接这些结点的 **链路（Link）** 组成

**互连网：** 多个网络通过路由器互连起来，这样就构成了一个覆盖范围更大的网络，即互连网。因此，互联网又称为“网络的网络（Network of Networks）”

**因特网：** 因特网（Internet）是世界上最大的互连网络（用户数以亿计，互连的网络数以百万计）

> **internet 与 Internet 的区别**
>
> - **internet(互连网)** 是一个通用名词，它泛指 **多个计算机网络互连而成的网络** 。在这些网络之间的通信协议可以是任意的
> - **Internet（因特网）则是一个专用名词** ，它 **特指采用 TCP/IP 协议族作为通信** 的规则当前全球最大的、开放的、由众多网络互连而成的特定计算机网络，其前身是美国的 ARPANET

> 任意把几个计算机网络互连起来（不管采用什么协议），并能够相互通信，这样构成的是一个互连网(internet) ，而不是因特网(Internet)

### 因特网发展的三个阶段

![互联网的发展](/blog/cs/road_of_Internet.png)

### 因特网服务提供者 ISP

互联网服务供应商 (Internet Service Provider) ，又称因特网服务提供者、互联网服务提供商、**网络服务供应商**，即指提供互联网访问服务的公司。通常大型的电信公司都会兼任互联网服务供应商，一些 ISP 则独立于电信公司之外

中国的三大 ISP：

![三大 IPS](/blog/cs/ISP.png)

ISP 可以从因特网管理机构申请到成块的 IP 地址，同时拥有通信线路以及路由器等联网设备。任何机构和个人只需缴纳费用，就可从 ISP 的得到所需要的 IP 地址

因为因特网上的主机都必须有 IP 地址才能进行通信，这样就可以通过该 ISP 接入到因特网

![基于 ISP 的三层结构的因特网](/blog/cs/ISP_net.png)

一旦某个用户能够接入到因特网，那么他也可以成为一个 ISP，所需要做的就是购买一些如调制解调器或路由器这样的设备，让其他用户可以和他相连

### 因特网的组成

- **边缘部分** <br> &emsp;&emsp; 由所有连接在因特网上的 **主机** 组成（台式电脑，大型服务器，笔记本电脑，平板，智能手机等）。这部分是 **用户直接使用** 的，用来进行 **通信** （传送数据、音频或视频）和 **资源共享**
- **核心部分** <br> &emsp;&emsp; 由 **大量网络** 和连接这些网络的**路由器**组成。这部分是 **为边缘部分提供服务** 的（提供连通性和交换）

#### 其中

- **路由器** 是一种专用计算机，但我们不称它为主机。路由器是实现分组交换的关键构建，其任务是转发收到的分组，这是网络核心最重要的部分
- 处在互联网边缘的部分就是连接在互联网上的所有的主机。这些主机又称为 **端系统 (end system)**

## 网络的三种交换方式

网络核心部分是互联网中最复杂的部分，要向网络边缘中的大量主机提供连通性，使边缘部分中的任何一个主机都能够向其他主机通信（即传送或接收各种形式的数据）

在网络核心部分起特殊作用的是 **路由器(router)**。路由器是实现 **分组交换** (packet switching) 的关键构件，其任务是 **转发** 收到的分组，这是网络核心部分最重要的功能

### 电路交换（Circuit Switching）

“电路交换”又称为“线路交换”，是一种 **面向连接的服务**。两台计算机通过通信子网进行数据电路交换之前，首先要在通信子网中建立一个实际的物理线路连接。最普通的电路交换例子是电话系统

电路交换是根据**交换机结构**原理实现数据交换的。其主要任务是把要求通信的输入端与被呼叫的输出端接通，即由交换机负责在两者之间建立起一条物理通路。在完成接续任务之后，双方通信的内容和格式等均不受交换机的制约。电路交换方式的主要特点就是**要求在通信的双方之间建立一条实际的物理通路，并且在整个通信过程中，这条通路被独占**

![两两相连的线路交换的电话机](/blog/cs/Circuit_0.png)

近乎 $O(n^2)$ 的耗材很是不优雅，于是就有个**交换机**作为交换载体

![带有中间交换机只要 O(n) 的耗材](/blog/cs/Circuit_1.png)

从通信资源的分配角度来看，交换（Switching）就是按照某种方式动态地分配传输线路的资源

#### 电路交换的三个步骤

1. 建立连接（分配通信资源）
2. 通话（一直占用通信资源）
3. 释放连接（归还通信资源）

#### 电路交换的特点

- **独占性：** 在 建立电路之后、释放线路之前，即使站点之间无任何数据可以传输，整个线路仍不允许其他站点共享。就和打电话一样，我们讲话之前总要拨完号之后把这个连接建立，不管你讲不讲话，只要不挂机，这个连接是专为你所用的；如果没有可用的连接，用户将听到忙音。**因此线路的利用率较低，并且容易引起接续时的拥塞**

- **实时性好：** 一旦电路建立，通信双方的所有资源（包括线路资源）均用于本次通信，除了少量的传输延迟之外，不再有其他延迟，具有较好的**实时性**

- 电路交换设备简单，无需提供任何缓存装置。用户数据透明传输，要求收发双方自动进行速率匹配

#### 电路交换的特点与优缺点

- 优点是数据传输可靠、迅速，数据不会丢失，且保持原来的序列

- 缺点是在某些情况下，电路**空闲时的信道容量被浪费**；另外，如数据传输阶段的持续时间不长，电路建立和拆除所用的时间就得不偿失

- 因此，它适用于 **远程批处理信息传输** 或 **系统间实时性要求高的大量数据传输** 的情况。这种通信方式的计费方法一般按照预订的**带宽、距离和时间**来计算

### 报文交换（Message Switching）

所谓 **存储交换** 是指数据交换前，先通过缓冲存储器进行缓存，然后按队列进行处理。 “存储交换”又分为“报文交换” 和“分组交换” 两种，先讲较少使用的报文交换：

**报文交换原理：** 实现报文交换的过程如下

- 若某用户有发送报文需求，则需要先把拟发送的信息加上**报文头**，包括目标地址和源地址等信息，并将形成的报文发送给交换机。当交换机中的通信控制器检测到某用户线路有报文输入时，则向中央处理机发送中断请求，并逐字把报文送入**内存器**
- 中央处理机在接到报文后可以对报文进行处理，如分析报文头，判别和确定路由等，然后将报文转存到外部大容量存储器，等待一条空闲的输出线路
- 一旦线路空闲，就再把报文从外存储器调入内存储器，经通信控制器向线路发送出去

#### 报文交换的特点

- **存储－转发：** 报文交换方式首先是由交换机存储整个报文的，然后在有线路空闲时才进行必要的处理
- **不独占线路**，多个用户的数据可以通过存储和排队共享一条线路
- **无线路建立的过程**，提高了线路的利用率
- **支持多点传输**，一个报文传输给多个用户，只需在报文中增加“地址字段”，中间节点根据地址字段进行复制和转发
- 中间节点可进行数据格式的转换，方便接收站点的收取
- 增加了差错检测功能，避免出错数据的无谓传输等

#### 报文交换方式的优缺点

- 报文交换的优点有如下几个方面
  1. **线路利用率高**，信道可为多个报文共享
  2. 不需要同时启动发送器和接收器来传输数据，网络可暂存
  3. 通信量大时仍可接收报文，但传输延迟会增加
  4. 一份报文可发往多个目的地
  5. 交换网络可对报文进行速度和代码等的转换
  6. 能够实现报文的差错控制和纠错处理等功能
- 报文交换方式的不足之处如下
  1. 中间节点必须具备很大的存储空间
  2. 由于“存储－转发”和排队，增加了数据传输的延迟
  3. 报文长度未作规定，报文只能暂存在磁盘上，磁盘读取占用了额外的时间
  4. 任何报文都必须排队等待：不同长度的报文要求不同长度的处理和传输时间，即使非常短小的报文（例如，交互式通信中的会话信息）
  5. 当信道误码率高时，频繁重发，报文交换难以支持实时通信和交互式通信的要求

### 分组交换（Packet Switching）

“分组交换”与“报文交换”技术类似，但**规定了交换机处理和传输的数据长度**（称之为分组），不同用户的数据分组可以交织地在网络中的物理链路上传输，是目前应用最广的交换技术。**它结合了线路交换和报文交换两者的优点，使其性能达到最优**

![分组交换网络](/blog/cs/Packet.png)

为了理解分组交换的优越性，先了解一下“报文”与“报文分组”的区别：

- 数据通过通信子网传输时可以有报文（Message）与报文分组（Packet）两种方式。报文传输不管发送数据的长度是多少，都把它当做一个逻辑单元发送；而报文分组传输方式则限制一次传输数据的最大长度，**如果传输数据超过规定的最大长度，发送节点就将它分成多个报文分组发送**

- 由于分组长度较短，在传输出错时，检错容易并且重发花费的时间较少；限定分组最大数据长度后，有利于提高存储转发节点的存储空间利用率与传输效率。**公用数据网采用的是分组交换技术**

通常我们把表示该消息的整块数据成为一个报文

在发送报文之前，先把较长的报文划分成一个个更小的等长数据段，在每一个数据段前面。加上一些由必要的控制信息组成的首部后，就构成一个分组，也可简称为“**包**”（也就是*丢包*丢的东西）；相应地，首部也可称为“**包头**”。首部包含了分组的目的地址

#### 分组交换的特点

- 报文交换的缺点是由报文太长引起的，因此分组交换的思想是限制发送和转发的信息长度，将一个大报文分割成一定长度的信息单位，称为**分组**（包），并以分组为单位存储转发，在接收端再将各分组重新组装成一个完整的报文

- 分组交换试图兼有报文交换和线路交换的优点，而使两者的缺点最少。分组交换与报文交换的工作方式基本相同，形式上的主要差别在于：**分组交换网中要限制所传输的数据单位的长度**

### 三种交换方式的对比

#### 假设 A，B，C，D 是分组传输路径所要经过的 4 个结点交换机，纵坐标为时间

![三种交换方式](/blog/cs/Switching.png)

#### 电路交换

- 通信之前首先要建立连接；连接建立好之后，就可以使用已建立好的连接进行数据传送；数据传送后，需释放连接，以归还之前建立连接所占用的通信线路资源
- 一旦建立连接，中间的各结点交换机就是直通形式的，**比特流可以直达终点**

#### 报文交换

- 可以随时发送报文，而不需要事先建立连接；整个报文先传送到相邻结点交换机，全部存储下来后进行查表转发，转发到下一个结点交换机
- 整个报文需要在各结点交换机上进行存储转发，由于不限制报文大小，因此需要各结点交换机都具有较大的缓存空间

#### 分组交换

- 可以随时发送分组，而不需要事先建立连接。构成原始报文的一个个分组，依次在各结点交换机上存储转发。各结点交换机在发送分组的同时，还缓存接收到的分组
- 构成原始报文的一个个分组，在各结点交换机上进行存储转发，相比报文交换，减少了转发时延，还可以避免过长的报文长时间占用链路，同时也有利于进行差错控制

## 计算机网络的性能指标

### 速率

简单来讲，如 `100M`宽带是指峰值速率为 $100 Mbps = 100 Mb/s = 12.5 MB/s$，即为日常的 $12.5 M/s$ 的宽带

$$
\begin{align*}
  B &\rightarrow Byte \; (\text{字节}) \\
  b &\rightarrow bit \; (\text{比特}) \\
  1 \; Byte &= 8 \; bit
\end{align*}
$$

一般来说，**数据传输** 大多是以 **比特** 为单位的，这也就是为什么网速的单位大都是 `Mbps` 了；而 **数据存储** 是则以 **字节** 为单位，比如硬盘的读写速度一般就用的是 `MB/s`

![速率及单位之间的转换](/blog/cs/rate.png)

### 带宽

![带宽](/blog/cs/band_width.png)

### 吞吐量

网络中的数据是由一个个数据包组成，防火墙对每个数据包的处理要耗费资源。吞吐量是指 **在没有帧丢失的情况下，设备能够接受的最大速率**

其测试方法是：在测试中以一定速率发送一定数量的帧，并计算待测设备传输的帧，如果发送的帧与接收的帧数量相等，那么就将发送速率提高并重新测试；如果接收帧少于发送帧则降低发送速率重新测试，直至得出最终结果

![网络吞吐量](/blog/cs/tuntu.png)

带宽 `1 Gb/s` 的以太网，代表其额定速率是 `1 Gb/s`，这个数值也是该以太网的吞吐量的绝对上限值。因此，对于带宽 `1 Gb/s` 的以太网，可能实际吞吐量只有 `700 Mb/s`，甚至更低

> **注意：** 吞吐量还可以用每秒传送的字节数或帧数表示

### 时延

网络时延由几部分组成：

- **发送时延：** 主机或路由器发送数据帧所需要的时间，也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间
- **传播时延：** 电磁波在信道中传播一定的距离需要花费的时间
- **处理时延：** 主机或路由器在收到分组时要花费一定时间进行处理
- **排队时延：** 分组在进过网络传输时，要经过许多路由器。但分组在进入路由器后要先在输入队列中排队等待处理

#### 总时延 = 发送时延 + 传播时延 + 处理时延 （处理时延 + 排队时延）

![网络时延的计算](/blog/cs/delay.png)

> 当处理时延忽略不计时，发送时延和传播时延谁占主导要是情况分析

### 往返时间

互联网上的信息不仅仅单方向传输而是双向交互的。因此，我们有时很需要知道双向交互一次所需的时间

![往返时间](/blog/cs/RTT.png)

### 利用率

![利用率](/blog/cs/Utilization.png)

### 丢包率

![丢包率](/blog/cs/packet_lost.png)

## 计算机网络体系结构

计算机网络体系结构分为 3 种：**OSI 体系结构（七层）**，**TCP/IP 体系结构（四层）**，**五层体系结构**

1. OSI 体系结构：概念清楚理念完整，但复杂不实用
2. TCP/IP 体系结构：含了一系列构成互联网基础的网络协议，是 Internet 的核心协议，被广泛应用于局域网和广域网
3. 五层体系结构：融合了 OSI 与 TCP/IP 的体系结构，目的是为了学习讲解计算机原理

现如今按协议大多分为五层结构，自上而下有以下五层：

![网络体系](/blog/cs/NetworkSystem.png)

#### 其中

- **应用层：** 应用层是网络协议的最高层，主要任务**通过进程间的交互完成特定网络应用**。应用层协议定义的是应用程序（进程）间**通信和交互的规则**
  - 对于不同的网络应用需要有不同的应用层协议，在互联网中的应用层协议很多，如 **域名系统 DNS**，支持万维网应用的 **HTTP 协议**，支持电子邮件的 **SMTP 协议**，等等。应用层交互的数据单元称为 **报文**
- **运输层：** 有时也译为传输层，它负责为两台主机中的进程提供通信服务，包括了应用层报文向目的地的 **确保传递和流量控制**。该层主要有以下两种协议：
  - 传输控制协议 (`Transmission Control Protocol`，TCP)：提供面向连接的、**可靠的数据传输服务**，数据传输的基本单位是 **报文段**（segment）
  - 用户数据报协议 (`User Datagram Protocol`，UDP)：提供无连接的、尽最大努力的数据传输服务、没有流量控制，但不保证数据传输的可靠性，数据传输的基本单位是**用户数据报**
- **网络层：** 网络层负责为分组网络中的不同主机提供通信服务，并通过选择合适的 **路由** 将数据传递到目标主机
  - 在发送数据时，网络层把运输层产生的报文段或用户数据封装成分组或 **包(packet)** 进行传送
  - 在 `TCP/IP` 体系中，由于网络层使用 IP 协议，因此分组也叫 **IP 数据报**
- **数据链路层：** 数据链路层通常简称为链路层。数据链路层在两个相邻节点传输数据时，**将网络层交下来的 IP 数据报组装成帧**，在两个相邻节点之间的链路上传送帧
- **物理层：** 保证数据可以在各种物理媒介上进行传输，为数据的传输提供可靠的环境

### 分层应用实例

![传输过程](/blog/cs/Transmission_process.png)

两台局域网内的主机通过 HTTP 传输一张图片的过程可以描述如下：

- **应用层**：客户端的应用程序发起 HTTP 请求，请求图片资源，并且在请求头中指定了需要获取的图片的 URL 地址，然后将请求发送到应用层协议栈

- **传输层**：应用层协议栈将 HTTP 请求交给传输层协议栈，传输层会根据网络状况和传输协议的要求，选择 TCP 或 UDP 协议。通常情况下，HTTP 使用 TCP 协议，因为 TCP 具有可靠性，能够保证数据的完整性和可靠性。传输层协议栈将 HTTP 请求封装成 TCP 或 UDP 数据包，并添加源端口和目的端口

- **网络层**：传输层协议栈将 TCP 或 UDP 数据包交给网络层协议栈，网络层负责将数据包封装成 IP 数据包，并添加源 IP 地址和目的 IP 地址。在这一步中，如果源主机和目的主机不在同一个局域网内，则需要通过路由器进行转发

- **数据链路层**：网络层协议栈将 IP 数据包交给数据链路层协议栈，数据链路层将 IP 数据包封装成以太网帧，并添加源 MAC 地址和目的 MAC 地址。如果源主机和目的主机不在同一个子网内，则需要通过交换机进行转发

- **物理层**：数据链路层协议栈将以太网帧发送到物理层，物理层负责将数字信号转换为模拟信号，并通过网络介质传输到目的主机。接收方的物理层将模拟信号转换为数字信号，并将以太网帧交给数据链路层协议栈，然后按照以上的步骤解析出 HTTP 响应，最终客户端的应用程序将获取到请求的图片资源

如果两台主机**不在同一网段**内，中间经过了多层的路由器，那么整个过程会涉及到更多的网络层协议栈和路由器之间的通信。多出来的过程如下：

- **发送端网络层**：传输层协议栈将 TCP 或 UDP 数据包交给网络层协议栈，网络层会首先检查目的 IP 地址是否在本地子网内，如果不在，则通过路由表查找下一跳路由器的 IP 地址，并将数据包发送给下一跳路由器

- **中间路由层**：下一跳路由器收到数据包后，会进行路由选择和转发操作，将数据包转发到下一个路由器，直到数据包到达目的主机所在的子网。每个路由器都会更新数据包中的 TTL 值，并重新计算校验和

- **接收端网络层**：当数据包到达目的主机所在的子网时，目的主机的网络层协议栈接收到数据包，进行解包和解析，根据 TCP 或 UDP 协议将数据包交给传输层协议栈

在这个过程中，每个路由器都需要进行数据包的转发和路由选择，保证数据包能够从源主机到达目的主机。路由器之间通过协议如 OSPF, BGP 等协议来协商路由信息，保证数据能够正确转发

当两台主机的地理位置相隔很远时，数据包会经过多个路由器和多个物理链路，在每个路由器上都需要进行链路层和物理层的处理，以确保数据包能够正确地到达目的地。同时，为了保证数据传输的速度和可靠性，会使用高速物理链路，如光纤等

- 在链路层，数据包会被封装成帧，并添加帧头和帧尾信息。帧头包括源 MAC 地址和目的 MAC 地址等信息，帧尾包括帧校验序列等信息。在每个路由器上，帧头中的目的 MAC 地址会被更新为下一跳路由器的 MAC 地址，以确保数据包能够正确地到达目的地

- 在物理层，数据包会被转换成电信号或光信号，并通过物理链路传输。在跨越长距离时，通常会使用光纤等高速物理链路，以确保数据传输的可靠性和速度

### 各层中数据段、数据报、帧的区别

在计算机网络中，数据在传输过程中会被封装成不同的数据单元，这些数据单元命名为：数据段、数据报、数据包和帧。区别在于它们所处的网络层次和封装的内容不同：

- **数据段（Segment）**：在**传输层**中，数据段是指 TCP 或 UDP 协议传输的数据单位。在发送端，传输层将应用层传来的数据分成若干个数据段，每个数据段包含一个首部和一个负载部分，然后将这些数据段分别交给网络层进行传输。在接收端，网络层收到数据段后，将其重新组合成完整的数据

- **数据报/数据包（Datagram/Packet）**：在**网络层**中，数据报或数据包是指 IP 协议传输的数据单位。数据报由 IP 首部和 IP 数据组成，其中 IP 首部包含源 IP 地址和目的 IP 地址等信息，而 IP 数据则是传输层分段后的数据段的负载部分。在发送端，网络层将应用层的数据加上 IP 首部后封装成数据报，然后交给数据链路层进行传输。在接收端，数据链路层收到数据报后，将其解封并交给网络层进行处理

- **帧（Frame）**：在**数据链路层**中，帧是指以太网协议传输的数据单位。帧由帧首部、数据部分和帧尾部组成。帧首部包含源 MAC 地址和目的 MAC 地址等信息，数据部分则是网络层传来的数据报的负载部分，而帧尾部包含帧校验码等信息。在发送端，数据链路层将网络层传来的数据报加上帧首部和帧尾部后封装成帧，然后交给物理层进行传输。在接收端，物理层收到帧后，将其解封并交给数据链路层进行处理
